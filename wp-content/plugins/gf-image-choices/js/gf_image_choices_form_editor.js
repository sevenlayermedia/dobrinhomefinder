var imageChoicesAdmin=imageChoicesAdmin||{};!function(e){var i=""!==imageChoicesFieldVars.is_gf_min_2_5?2:1,o=i;console.log("GF_EDITOR_VERSION",i),imageChoicesAdmin.markup={removeChoicesButton:function(){return'<button class="button image-choices-remove-choices-btn" type="button" onclick="imageChoicesAdmin.removeAllChoices();">'+imageChoicesFieldStrings.removeAllChoices+"</button>"},choicesAdminRow:function(e,o,c){var t=void 0!==e?e:0,s=void 0!==o?o:"",c=void 0!==c?c:"",a='<i class="dashicons dashicons-format-image"></i>';return 1===i&&(a=imageChoicesFieldStrings.uploadImage),['<button type="button" id="image-choices-option-upload-button-'+t+'" class="button image-choices-option-upload-button" onclick="imageChoicesAdmin.OpenMediaLibrary(this);" title="'+imageChoicesFieldStrings.uploadImage+'">'+a+"</button>",'<span id="image-choices-option-preview-'+t+'" class="image-choices-option-preview-wrap">','<span class="image-choices-option-preview" style="background-image:url('+s+');"></span>','<a href="javascript:void(0);" class="image-choices-option-image-remove" onclick="imageChoicesAdmin.RemovePreview(this);" title="'+imageChoicesFieldStrings.removeImage+'"><i class="dashicons dashicons-no"></i></a>',"</span>",'<input type="hidden" id="image-choices-option-image-'+t+'" class="image-choices-option-image" value="'+s+'" />','<input type="hidden" id="image-choices-option-image-id-'+t+'" class="image-choices-option-image-id" value="'+c+'" />'].join("")},choicesPreviewRow:function(e,i,o){var c=void 0!==i?i:"",t=void 0!==o?o:"";return['<span class="image-choices-choice-image-wrap" style="background-image:url('+t+')">','<img src="'+t+'" alt="" class="image-choices-choice-image" />',"</span>",'<span class="image-choices-choice-text">'+c+"</span>"].join("")}},imageChoicesAdmin.getChoices=function(o){"undefined"==typeof o&&(o=GetSelectedField());var c=2===i?".field-choice-row":'[class*="-choice-row"]';imageChoicesAdmin.getSettingsElement().find(c).each(function(){var i=e(this),c=i.data("index"),t=o.choices.length&&void 0!==o.choices[c].imageChoices_image?o.choices[c].imageChoices_image:"",s=o.choices.length&&void 0!==o.choices[c].imageChoices_imageID?o.choices[c].imageChoices_imageID:"";i.find(".image-choices-option-image").length||i.find(".field-choice-text").before(imageChoicesAdmin.markup.choicesAdminRow(c,t,s));var a=i.find(".image-choices-option-image");""!==a.val()&&i.addClass("image-choices-has-image")}),imageChoicesAdmin.updateFieldPreview(o)},imageChoicesAdmin.RemovePreview=function(i){if("undefined"!=typeof i){var o=e(i).closest('[class*="-choice-row"]');o.find(".image-choices-option-image").val(""),o.find(".image-choices-option-image-id").val(""),o.find(".image-choices-option-preview").css("background-image",""),o.removeClass("image-choices-has-image"),imageChoicesAdmin.UpdateFieldChoicesObject();var c=GetSelectedField();imageChoicesAdmin.updateFieldPreview(c)}},imageChoicesAdmin.UpdateFieldChoicesObject=function(){var o=GetSelectedField(),c=imageChoicesAdmin.getSettingsElement(),t="quiz"===o.type&&1===i?".gquiz-choice-row":'[class*="-choice-row"]';c.find(t).each(function(i){var c=e(this),t=c.find(".image-choices-option-image").val(),s=c.find(".image-choices-option-image-id").val(),a=c.data("index");""!==t?(c.addClass("image-choices-has-image"),c.find(".gf-image-choices-option-preview").css("background-image","url("+t+")")):c.removeClass("image-choices-has-image"),o.choices[a].imageChoices_image=t,o.choices[a].imageChoices_imageID=s})},imageChoicesAdmin.updateFieldPreview=function(i){var o=e("#field_"+i.id);i.imageChoices_enableImages&&void 0===i.imageChoices_showLabels&&imageChoicesAdmin.toggleShowLabels(!0),imageChoicesAdmin.$fieldChoices(o).each(function(o){var c=e(this);c.addClass("image-choices-choice");var t=c.find("label"),s=t.find(".image-choices-choice-text").length?t.find(".image-choices-choice-text").html():t.html();if(i.imageChoices_enableImages){if(i.choices.length>o){var a=void 0!==i.choices[o].imageChoices_image?i.choices[o].imageChoices_image:"";t.html(imageChoicesAdmin.markup.choicesPreviewRow(o,s,a))}}else t.html(s)})},imageChoicesAdmin.getField=function(){var i=GetSelectedField();return e("#field_"+i.id)},imageChoicesAdmin.removeAllChoices=function(){imageChoicesAdmin.getSettingsElement().find(".image-choices-option-image-remove").each(function(){e(this).trigger("click")}),$settingsWrap.find(".gf_delete_field_choice").each(function(){e(this).trigger("click")}),$settingsWrap.find('.field-choice-row input[type="text"], .gquiz-choice-row input[type="text"]').val("")},imageChoicesAdmin.isColorPickerPluginActive=function(){return window.hasOwnProperty("colorPickerFieldVars")&&"undefined"!=typeof window.colorPickerFieldVars},imageChoicesAdmin.toggleEnableImages=function(e){var i=imageChoicesAdmin.getSettingsElement(),o=i.find("input.field_choice_images_enabled"),c=i.find("input.field_choice_colors_enabled");void 0===e&&(e=o.is(":checked")),e&&imageChoicesAdmin.isColorPickerPluginActive()&&c.length&&c.is(":checked")?window.confirm(imageChoicesFieldStrings.confirmImagesToggle)?(window.hasOwnProperty("colorPicker_toggleEnableColors")&&"function"==typeof window.colorPicker_toggleEnableColors&&window.colorPicker_toggleEnableColors(!1),imageChoicesAdmin.onToggleEnableImages(e)):o.prop("checked",!1):imageChoicesAdmin.onToggleEnableImages(e)},window.imageChoices_toggleEnableImages=imageChoicesAdmin.toggleEnableImages,imageChoicesAdmin.onToggleEnableImages=function(o){var c=imageChoicesAdmin.getField(),t=imageChoicesAdmin.getSettingsElement(),s=t.find("input.field_choice_images_enabled");void 0===o&&(o=s.is(":checked")),SetFieldProperty("imageChoices_enableImages",o),s.prop("checked",o),2===i&&e("#image_choices_tab_toggle").toggle(o);var a=e(2===i?"#gfield_settings_choices_container":'[id*="gfield_settings_choices_container"]');a.toggleClass("image-choices-enabled",o),c.toggleClass("image-choices-use-images",o),2===i&&t.toggleClass("image-choices-use-images",o);var n=t.find("#gfield_settings_choices_container + input"),g=t.find(".image-choices-remove-choices-btn");if(o&&!g.length&&1===i){n.length&&n.after(imageChoicesAdmin.markup.removeChoicesButton());var d=t.find("#gquiz_gfield_settings_choices_container + input");d.length&&1===i&&d.after(imageChoicesAdmin.markup.removeChoicesButton())}o||g.length&&g.remove();var m=GetSelectedField(),h=e(".field_setting.other_choice_setting"),l="radio"===m.type||"poll"===m.type&&"radio"===m.inputType;l&&h.show(),imageChoicesAdmin.updateFieldPreview(m)},imageChoicesAdmin.toggleShowLabels=function(e){var i=imageChoicesAdmin.getField(),o=imageChoicesAdmin.getSettingsElement().find("input.image_choices_show_labels");void 0===e&&(e=o.is(":checked")),SetFieldProperty("imageChoices_showLabels",e),o.prop("checked",e),i.toggleClass("image-choices-show-labels",e)},imageChoicesAdmin.toggleShowPrices=function(e){var i=imageChoicesAdmin.getField(),o=imageChoicesAdmin.getSettingsElement().find("input.image_choices_show_prices");void 0===e&&(e=o.is(":checked")),SetFieldProperty("imageChoices_showPrices",e),o.prop("checked",e),i.toggleClass("image-choices-show-prices",e)},imageChoicesAdmin.toggleUseLightbox=function(i){var o=imageChoicesAdmin.getField(),c=imageChoicesAdmin.getSettingsElement().find("input.image_choices_use_lightbox");if(void 0===i&&(i=c.is(":checked")),SetFieldProperty("imageChoices_useLightbox",i),c.prop("checked",i),o.toggleClass("image-choices-use-lightbox",i),i){var t=GetSelectedField();e.each(t.choices,function(e,i){var o=i.hasOwnProperty("imageChoices_image")&&""!==i.imageChoices_image,c=i.hasOwnProperty("imageChoices_imageID")&&""!==i.imageChoices_imageID;if(o&&!c)return window.alert(imageChoicesFieldStrings.useLightboxWarning),!1})}},imageChoicesAdmin.updateEntrySetting=function(e){SetFieldProperty("imageChoices_entrySetting",e),imageChoicesAdmin.getSettingsElement().find("#image-choices-entry-value").val(e)},imageChoicesAdmin.OpenMediaLibrary=function(i){if("undefined"!=typeof i){var o=e(i).closest('[class*="-choice-row"]'),c=o.data("file-frame");if(c)return void c.open();c=wp.media({title:"Select an image to upload",button:{text:"Use this image"},frame:"post",state:"insert",multiple:!1}),setTimeout(function(){e('input[value="Insert into Post"]').val("Use this Image"),e("button.media-button-insert").text("Use this Image")},100),jQuery("body").on("click","li.attachment",function(){e('input[value="Insert into Post"]').val("Use this Image"),e("button.media-button-insert").text("Use this Image")}),c.on("insert",function(e){var i=c.state();if(e=e||i.get("selection")){var t=e.first(),s=i.display(t).toJSON();t=t.toJSON();var a=t.sizes[s.size].url;o.find(".image-choices-option-image").val(a),o.find(".image-choices-option-image-id").val(t.id),o.find(".image-choices-option-preview").css("background-image","url("+a+")"),o.addClass("image-choices-has-image"),imageChoicesAdmin.UpdateFieldChoicesObject();var n=GetSelectedField();imageChoicesAdmin.updateFieldPreview(n)}}),c.open(),o.data("file-frame",c)}},imageChoicesAdmin.fieldCanHaveImages=function(e){return!("undefined"==typeof e||!e.hasOwnProperty("type"))&&("radio"===e.type||"checkbox"===e.type||"quiz"===e.type&&"radio"==e.inputType||"quiz"===e.type&&"checkbox"==e.inputType||"poll"===e.type&&"radio"==e.inputType||"poll"===e.type&&"checkbox"==e.inputType||"post_custom_field"===e.type&&"radio"==e.inputType||"post_custom_field"===e.type&&"checkbox"==e.inputType||"survey"===e.type&&"radio"==e.inputType||"survey"===e.type&&"checkbox"==e.inputType||"product"===e.type&&"radio"==e.inputType||"option"===e.type&&"radio"==e.inputType||"option"===e.type&&"checkbox"==e.inputType)},imageChoicesAdmin.$fieldChoices=function(e){if("undefined"==typeof e||e instanceof jQuery==!1)return[];var o='.ginput_container .gfield_radio div[class*="gchoice"], .ginput_container .gfield_checkbox .gchoice:not(.gchoice_select_all)';return 1===i&&(o=".ginput_container .gfield_radio li, .ginput_container .gfield_checkbox li:not(.gchoice_select_all)"),e.find(o)},imageChoicesAdmin.getSettingsElement=function(){var o=e("#field_settings_container");return 1===i&&(o=e("#field_settings")),o},imageChoicesAdmin.previewHeight=function(e){if("object"!=typeof e){var i=imageChoicesAdmin.getField();e=i.find(".ginput_container")}e.length&&e.closest(".gfield").hasClass("image-choices-admin-field")&&setTimeout(function(){e.height(e.find("> ul:first").outerHeight())},20)},"undefined"!=typeof gform&&gform.addAction("gform_load_field_choices",function(o){var c="undefined"!=typeof o&&o.length?o[0]:GetSelectedField(),t=2===i?10:100;setTimeout(function(){var i=e("#field_"+c.id),o=imageChoicesAdmin.getSettingsElement();if(imageChoicesAdmin.fieldCanHaveImages(c)){i.addClass("image-choices-admin-field"),o.addClass("image-choices-field-settings");var t=c.imageChoices_enableImages===!0,s=void 0!==c.imageChoices_useLightbox&&c.imageChoices_useLightbox,a=void 0===c.imageChoices_showLabels||c.imageChoices_showLabels,n="product"===c.type&&void 0!==c.imageChoices_showPrices&&c.imageChoices_showPrices,g=void 0!==c.imageChoices_entrySetting?c.imageChoices_entrySetting:"form_setting";imageChoicesAdmin.toggleEnableImages(t),imageChoicesAdmin.toggleUseLightbox(s),imageChoicesAdmin.toggleShowLabels(a),imageChoicesAdmin.toggleShowPrices(n),imageChoicesAdmin.updateEntrySetting(g),imageChoicesAdmin.getChoices(c)}else i.removeClass("image-choices-admin-field"),o.removeClass("image-choices-field-settings"),imageChoicesAdmin.toggleEnableImages(!1)},t)}),e(document).bind("gform_load_field_settings",function(i,c,t){o=t.hasOwnProperty("markupVersion")&&""!==t.markupVersion?t.markupVersion:1,console.log("GF_MARKUP_VERSION",o),"function"!=typeof window.imageChoices_GF_UpdateFieldChoices&&(window.imageChoices_GF_UpdateFieldChoices=UpdateFieldChoices,window.UpdateFieldChoices=function(){window.imageChoices_GF_UpdateFieldChoices.apply(this,arguments),e(window).trigger("gf_update_field_choices")}),imageChoicesAdmin.previewHeight()}),e(window).on("gf_update_field_choices",function(){setTimeout(function(){imageChoicesAdmin.getChoices()},10),imageChoicesAdmin.previewHeight()}),e(document).on(".gf_insert_field_choice, .gf_delete_field_choice",function(e){imageChoicesAdmin.previewHeight()}),e(document).ready(function(){e(".gfield.image-choices-admin-field").each(function(){imageChoicesAdmin.$fieldChoices(e(this)).addClass("image-choices-choice")}),e("#gform_fields .gfield .ginput_container").each(function(){imageChoicesAdmin.previewHeight(e(this))});var i,o=e("#gf_image_choices_custom_css_global");o.length&&(o.after('<div id="gf_image_choices_custom_css_global_editor">'+o.text()+"</div>"),i=ace.edit("gf_image_choices_custom_css_global_editor"),i.setOptions({showInvisibles:!1,showGutter:!0,showLineNumbers:!0,displayIndentGuides:!1,scrollPastEnd:!1,theme:"ace/theme/xcode"}),i.session.setMode("ace/mode/css"),i.getSession().on("change",function(){o.val(i.getSession().getValue())}));var c=e("#gf_image_choices_custom_css");c.length&&(c.after('<div id="gf_image_choices_custom_css_editor">'+c.text()+"</div>"),i=ace.edit("gf_image_choices_custom_css_editor"),i.setOptions({showInvisibles:!1,showGutter:!0,showLineNumbers:!0,showFoldWidgets:!1,displayIndentGuides:!1,scrollPastEnd:!1,theme:"ace/theme/xcode"}),i.session.setMode("ace/mode/css"),i.getSession().on("change",function(){c.val(i.getSession().getValue())}))})}(jQuery);